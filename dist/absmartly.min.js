!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.absmartly=t():e.absmartly=t()}(self,(function(){return function(){var e={131:function(e,t,n){e.exports=self.fetch||(self.fetch=n(378).default||n(378))},378:function(e,t,n){"use strict";function r(e,t){return t=t||{},new Promise((function(n,r){var i=new XMLHttpRequest,o=[],a=[],s={},u=function(){return{ok:2==(i.status/100|0),statusText:i.statusText,status:i.status,url:i.responseURL,text:function(){return Promise.resolve(i.responseText)},json:function(){return Promise.resolve(i.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([i.response]))},clone:u,headers:{keys:function(){return o},entries:function(){return a},get:function(e){return s[e.toLowerCase()]},has:function(e){return e.toLowerCase()in s}}}};for(var c in i.open(t.method||"get",e,!0),i.onload=function(){i.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(e,t,n){o.push(t=t.toLowerCase()),a.push([t,n]),s[t]=s[t]?s[t]+","+n:n})),n(u())},i.onerror=r,i.withCredentials="include"==t.credentials,t.headers)i.setRequestHeader(c,t.headers[c]);i.send(t.body||null)}))}n.r(t),n.d(t,{default:function(){return r}})},143:function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,o=(i=n(131))&&i.__esModule?i:{default:i},a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=Object.assign({endpoint:void 0,apiKey:void 0,environment:void 0,agent:"javascript-client",application:{name:"default",version:0},retries:5,timeout:500},t);for(var n=0,r=["apiKey","endpoint","environment"];n<r.length;n++){var i=r[n];if(!(i in this.options)||void 0===this.options[i])throw new Error("Missing '".concat(i,"' in options argument"));var o=this.options[i];if("string"!=typeof o||0===o.length)throw new Error("Invalid '".concat(i,"' in options argument"))}this.delay=Math.max(10,t.timeout/(1<<t.retries))}var t,n;return t=e,(n=[{key:"createContext",value:function(e){var t={agent:this.options.agent,environment:this.options.environment,application:e.application||this.options.application,units:e.units};return this.post("/context",t)}},{key:"publish",value:function(e){var t={agent:this.options.agent,environment:this.options.environment,guid:e.guid,application:e.application||this.options.application,units:e.units};return Array.isArray(e.goals)&&e.goals.length>0&&(t.goals=e.goals),Array.isArray(e.exposures)&&e.exposures.length>0&&(t.exposures=e.exposures),Array.isArray(e.attributes)&&e.attributes.length>0&&(t.attributes=e.attributes),this.put("/context",t)}},{key:"request",value:function(e,t,n){var r=this,i="".concat(this.options.endpoint).concat(t),a=function(){return(0,o.default)(i,{method:e,headers:{"Content-Type":"application/json","X-API-Key":r.options.apiKey},body:JSON.stringify(n,null,0)}).then((function(e){if(!e.ok){var t=e.status>=400&&e.status<500;return e.text().then((function(n){var r=new Error(null!==n&&n.length>0?n:e.statusText);return r._bail=t,Promise.reject(r)}))}return e.json()}))},s=function(e){return new Promise((function(t){setTimeout(t,e)}))};return function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return a().catch((function(a){if(a._bail||i>=t||o>=n)return Promise.reject(a);var u=(1<<i)*r.delay+.5*Math.random()*r.delay;return o+u>n&&(u=n-o),s(u).then((function(){return e(t,n,i+1,o+u)}))}))}(this.options.retries,this.options.timeout)}},{key:"post",value:function(e,t){return this.request("POST",e,t)}},{key:"put",value:function(e,t){return this.request("PUT",e,t)}}])&&r(t.prototype,n),e}();t.default=a},431:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"Client",{enumerable:!0,get:function(){return i.default}});var r,i=(r=n(143))&&r.__esModule?r:{default:r}},899:function(e,t,n){"use strict";t.default=void 0;var r,i=(r=n(57))&&r.__esModule?r:{default:r},o=n(962),a={SDK:i.default,mergeConfig:o.mergeConfig};t.default=a},962:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mergeConfig=function(e,t){var n,r=(0,i.default)(t),a=e.experiments(),s=function(e){return e instanceof Object&&e.constructor===Object},u=o(a);try{var c=function(){var t,i=n.value,a=o(e.experimentConfig(i));try{for(a.s();!(t=a.n()).done;){var u=t.value,c=r,f=u.key;if(-1!==f.indexOf(".")){var l=f.split(".");for(var p in f=l.pop(),l){var y=l[p];y in c?s(c[y])?c=c[y]:(console.warn("Config key '".concat(u.key,"' for experiment '").concat(i,"' is overriding non-object value at '").concat(l.slice(0,p+1).join("."),"' with an object.")),c=c[y]={}):c=c[y]={}}}f in c&&"_".concat(f,"_setter")in Object.getOwnPropertyDescriptor(c,f)?console.error("Config key '".concat(u.key,"' already set by experiment ").concat(c["_".concat(f,"_setter")])):function(){Object.defineProperty(c,"_".concat(f,"_setter"),{value:i,writable:!1});var t=void 0;switch(u.format||"string"){case"string":t=u.value;break;case"json":try{t=JSON.parse(u.value)}catch(e){console.warn("Error parsing JSON in Config key '".concat(u.key,"' for experiment '").concat(i,"': ").concat(e))}break;default:console.warn("Unsupported format '".concat(u.format,"' in Config key '").concat(u.key,"' for experiment '").concat(i,"'.")),t=u.value}f in c&&(s(c[f])&&!s(t)?console.warn("Config key '".concat(u.key,"' for experiment '").concat(i,"' is overriding object with non-object value.")):!s(c[f])&&s(t)&&console.warn("Config key '".concat(u.key,"' for experiment '").concat(i,"' is overriding non-object value with object."))),Object.defineProperty(c,f,{get:function(){return e.treatment(i),t}})}()}}catch(e){a.e(e)}finally{a.f()}};for(u.s();!(n=u.n()).done;)c()}catch(e){u.e(e)}finally{u.f()}return r};var r,i=(r=n(697))&&r.__esModule?r:{default:r};function o(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw o}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}},266:function(e,t){"use strict";function n(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=function(){function e(t,i,o){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sdk=t,this.client=i,this.pendingCount=0,this.failed=!1;var s=function(e){var t;a._data=e,a.assignments=Object.assign.apply(Object,[{}].concat(function(e){if(Array.isArray(e))return r(e)}(t=(e.assignments||[]).map((function(e,t){return n={},i=t,(r=e.name)in n?Object.defineProperty(n,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[r]=i,n;var n,r,i})))||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(t)||n(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())),a.exposed={},a.pendingExposures=[],a.pendingGoals=[],a.currentAttributes=[]};o instanceof Promise?this.promise=o.then((function(e){s(e),delete a.promise})).catch((function(e){console.error("ABSmartly Context: ".concat(e)),s({}),a.failed=!0,delete a.promise})):s(o)}var t,o;return t=e,(o=[{key:"isReady",value:function(){return void 0===this.promise}},{key:"isFailed",value:function(){return this.failed}},{key:"ready",value:function(){var e=this;return this.isReady()?Promise.resolve(!0):new Promise((function(t){e.promise.then((function(){return t(!0)})).catch((function(e){return t(e)}))}))}},{key:"pending",value:function(){return this.pendingCount}},{key:"data",value:function(){return this._checkReady(),this._data}},{key:"publish",value:function(){var e=this;return this._checkReady(),new Promise((function(t,n){e._flush((function(e){e?n(e):t()}))}))}},{key:"attribute",value:function(e,t){this.currentAttributes.push({name:e,value:t.toString(),setAt:Date.now()})}},{key:"attributes",value:function(e){for(var t=Date.now(),r=0,i=Object.entries(e);r<i.length;r++){var o=(u=i[r],c=2,function(e){if(Array.isArray(e))return e}(u)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}(u,c)||n(u,c)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=o[0],s=o[1];this.currentAttributes.push({name:a,value:s.toString(),setAt:t})}var u,c}},{key:"treatment",value:function(e,t){return this._treatment(e,t)}},{key:"track",value:function(e,t,n){return this._track(e,t,n)}},{key:"experiments",value:function(){return this._checkReady(),Object.keys(this.assignments)}},{key:"experimentConfig",value:function(e){return this._checkReady(),e in this.assignments&&this._data.assignments[this.assignments[e]].config||[]}},{key:"_checkReady",value:function(){if(!this.isReady())throw new Error("ABSmartly Context is not yet ready.")}},{key:"_treatment",value:function(e){this._checkReady();var t=e in this.assignments,n=t?this._data.assignments[this.assignments[e]].variant:0;return e in this.exposed||(this.pendingExposures.push({name:e,variant:n,exposedAt:Date.now(),assigned:t}),this.pendingCount++,this.exposed[e]=!0),n}},{key:"_track",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._checkReady(),null!=t){if(Array.isArray(t)){if(t.length>2)throw new Error("Goal values array length must be <= 2.")}else t=[t];if(t.some((function(e){return!Number.isInteger(e)})))throw new Error("Goal values must be integers")}this.pendingGoals.push({name:e,values:t,achievedAt:Date.now()}),this.pendingCount++}},{key:"_flush",value:function(e){if(0===this.pendingCount)"function"==typeof e&&e();else{if(this.failed)"function"==typeof e&&e();else{var t={guid:this._data.guid,units:this._data.units,application:this._data.application};this.pendingGoals.length>0&&(t.goals=this.pendingGoals.map((function(e){return{name:e.name,achievedAt:e.achievedAt,values:e.values}}))),this.pendingExposures.length>0&&(t.exposures=this.pendingExposures.map((function(e){return{name:e.name,exposedAt:e.exposedAt,variant:e.variant,assigned:e.assigned}}))),this.currentAttributes.length>0&&(t.attributes=this.currentAttributes.map((function(e){return{name:e.name,value:e.value,setAt:e.setAt}}))),this.client.publish(t).then((function(){"function"==typeof e&&e()})).catch((function(t){"function"==typeof e&&e(t)}))}this.pendingCount=0,this.pendingExposures=[],this.pendingGoals=[]}}}])&&i(t.prototype,o),e}();t.default=o},57:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,i=n(431),o=(r=n(266))&&r.__esModule?r:{default:r};function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=Object.assign({agent:"javascript-sdk"},t),this.client=new i.Client(t)}var t,n;return t=e,(n=[{key:"createContext",value:function(e){var t=Object.assign({},e,{units:Object.keys(e.units).map((function(t){return{type:t,uid:e.units[t]}}))}),n=this.client.createContext(t);return new o.default(this,this.client,n)}},{key:"createContextWith",value:function(e){return new o.default(this,this.client,e)}}])&&a(t.prototype,n),e}();t.default=s},697:function(e,t,n){"use strict";e.exports=n(188)()},188:function(e){"use strict";function t(e){return e instanceof Buffer?Buffer.from(e):new e.constructor(e.buffer.slice(),e.byteOffset,e.length)}e.exports=function(e){return(e=e||{}).circles?function(e){var n=[],r=[];return e.proto?function e(o){if("object"!=typeof o||null===o)return o;if(o instanceof Date)return new Date(o);if(Array.isArray(o))return i(o,e);var a={};for(var s in n.push(o),r.push(a),o){var u=o[s];if("object"!=typeof u||null===u)a[s]=u;else if(u instanceof Date)a[s]=new Date(u);else if(ArrayBuffer.isView(u))a[s]=t(u);else{var c=n.indexOf(u);a[s]=-1!==c?r[c]:e(u)}}return n.pop(),r.pop(),a}:function e(o){if("object"!=typeof o||null===o)return o;if(o instanceof Date)return new Date(o);if(Array.isArray(o))return i(o,e);var a={};for(var s in n.push(o),r.push(a),o)if(!1!==Object.hasOwnProperty.call(o,s)){var u=o[s];if("object"!=typeof u||null===u)a[s]=u;else if(u instanceof Date)a[s]=new Date(u);else if(ArrayBuffer.isView(u))a[s]=t(u);else{var c=n.indexOf(u);a[s]=-1!==c?r[c]:e(u)}}return n.pop(),r.pop(),a};function i(e,i){for(var o=Object.keys(e),a=new Array(o.length),s=0;s<o.length;s++){var u=o[s],c=e[u];if("object"!=typeof c||null===c)a[u]=c;else if(c instanceof Date)a[u]=new Date(c);else if(ArrayBuffer.isView(c))a[u]=t(c);else{var f=n.indexOf(c);a[u]=-1!==f?r[f]:i(c)}}return a}}(e):e.proto?function e(r){if("object"!=typeof r||null===r)return r;if(r instanceof Date)return new Date(r);if(Array.isArray(r))return n(r,e);var i={};for(var o in r){var a=r[o];"object"!=typeof a||null===a?i[o]=a:a instanceof Date?i[o]=new Date(a):ArrayBuffer.isView(a)?i[o]=t(a):i[o]=e(a)}return i}:function e(r){if("object"!=typeof r||null===r)return r;if(r instanceof Date)return new Date(r);if(Array.isArray(r))return n(r,e);var i={};for(var o in r)if(!1!==Object.hasOwnProperty.call(r,o)){var a=r[o];"object"!=typeof a||null===a?i[o]=a:a instanceof Date?i[o]=new Date(a):ArrayBuffer.isView(a)?i[o]=t(a):i[o]=e(a)}return i};function n(e,n){for(var r=Object.keys(e),i=new Array(r.length),o=0;o<r.length;o++){var a=r[o],s=e[a];"object"!=typeof s||null===s?i[a]=s:s instanceof Date?i[a]=new Date(s):ArrayBuffer.isView(s)?i[a]=t(s):i[a]=n(s)}return i}}}},t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}return n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(899)}().default}));